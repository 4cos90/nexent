name: nexent

services:
  nexent:
    image: nexent/nexent
    container_name: nexent
    restart: always
    ports:
      - "5010:5010"
    volumes:
      - ../:/opt/
      - ./uploads:/opt/backend/uploads
    environment:
      ELASTIC_PASSWORD: nexent@2025
      ELASTICSEARCH_API_KEY: bm9jR0g1Y0JUcW92OXVCRHdSUDM6MXJNcG1hTWRSSjIwUUFwY1dZRnZTQQ==
      MINIO_ACCESS_KEY: 025b36e11e51354f92633956
      MINIO_SECRET_KEY: wXgJ0sg9xfZy6fJQMveW69QnGxWsOz5I5YgMULoc3oY=
      MINIO_REGION: cn-north-1
      MINIO_DEFAULT_BUCKET: nexent
      skip_proxy: "true"
      UPLOAD_FOLDER: /opt/backend/uploads
      UMASK: 0022
    env_file:
      - .env
    user: root
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
    networks:
      - nexent
    entrypoint: "/bin/bash"
    command: >
      -c "
      apt-get update &&
      apt-get install -y iputils-ping netcat-openbsd net-tools dnsutils curl &&
      rm -rf /var/lib/apt/lists/* &&
      sleep infinity
      "


  nexent-data-process:
    image: nexent/nexent-data-process:latest
    container_name: nexent-data-process
    restart: always
    privileged: true
    ports:
      - "5012:5012"
    volumes:
      - ../:/opt/:cached
      - ./uploads:/opt/backend/uploads
    environment:
      skip_proxy: "true"
    env_file:
      - .env
    networks:
      - nexent
    user: root
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
    entrypoint: "/bin/bash"
    command: "-c 'sleep infinity'"

networks:
  nexent:
    driver: bridge